{
  "hash": "47ddf98d380eafd4df171800833e51fd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Análisis de la Varianza (ANOVA)\nknitr: \n    opts_chunk: \n      R.options:\n        warning: false\nlang: es\n---\n\n\n## Ejercicios Resueltos\n\nPara la realización de esta práctica se requieren los siguientes paquetes:\n\n```r\nlibrary(tidyverse)\n# Incluye los siguientes paquetes:\n# - dplyr: para el preprocesamiento y manipulación de datos.\nlibrary(broom) # para convertir las listas con los resúmenes de los modelos de regresión a formato organizado.\nlibrary(tidymodels) # para realizar contrastes de hipótesis en formato tidy.\nlibrary(pwr) # para el cálculo de tamaños muestrales.\nlibrary(knitr) # para el formateo de tablas.\n```\n\n:::{#exr-anova-un-factor-contaminacion}\nSe quiere comparar la contaminación por dióxido de nitrógeno (NO2) en tres lugares distintos de una ciudad $A$, $B$ y $C$ y para ello se han medido las concentraciones de NO2 en cada lugar en una muestra aleatoria de días, obteniendo los resultados de la siguiente tabla.\n\n$$\n\\begin{array}{lrrrrrrrrrrrr}\n\\hline\nA & 19.8 & 21.1 & 28.2 & 22.3 & 22.5 & 28.9 & 23.8 & 16.9 \\\\\nB & 31.6 & 32.8 & 41.1 & 36.8 & 37.0 & 35.6 & 32.2 & 43.9 & 37.5 & 25.2 \\\\\nC & 37.2 & 30.2 & 26.6 & 31.7 & 26.8 & 28.6 & 29.2 & 22.9 & 38.0 & 33.9 & 26.2 & 40.5 \\\\\n\\hline\n\\end{array}\n$$\n\na.  Crear un conjunto de datos con los datos de la muestra.\n\n    :::{.callout-tip collapse=\"true\"}\n    ## Solución\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    df <- data.frame(nitrogeno = c(19.8, 21.1, 28.2, 22.3, 22.5, 28.9, 23.8, 16.9, 31.6, 32.8, 41.1, 36.8, 37.0, 35.6, 32.2, 43.9, 37.5, 25.2, 37.2, 30.2, 26.6, 31.7, 26.8, 28.6, 29.2, 22.9, 38.0, 33.9, 26.2, 40.5),\n    lugar = rep(c(\"A\", \"B\", \"C\"), c(8, 10, 12)))\n    ```\n    :::\n\n    :::\n\na.  Dibujar el diagrama de cajas con los puntos correspondientes a las mediciones de cada lugar y sus medias. A la vista del diagrama, ¿crees que existen diferencias significativas entre los niveles de NO2 de los tres lugares?\n\n    :::{.callout-tip collapse=\"true\"}\n    ## Solución\n    \n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    library(tidyverse)\n    media <- mean(df$nitrogeno)\n    df |> \n        ggplot(aes(x = lugar, y = nitrogeno, fill = lugar)) +\n        geom_boxplot(alpha = 0.5) +\n        geom_point() + \n        stat_summary(fun = mean, geom = \"point\", size = 3, color = \"red\") +\n        geom_hline(yintercept = media, color = \"red\") +\n        geom_text(aes(x = 0.7, y = media + 0.5, label = \"Media global\") )\n    ```\n    \n    ::: {.cell-output-display}\n    ![](10-anova_files/figure-html/unnamed-chunk-2-1.png){width=672}\n    :::\n    :::\n\n\n    Como se puede apreciar en el diagrama existen diferencias muy claras entre los niveles de NO2 de los tres lugares, especialmente entre $B$ y $A$.\n    :::\n\na.  Realizar un contraste ANOVA para ver si hay diferencias estadísticamente significativas entre las concentraciones medias de NO2 de los tres lugares.\n\n    :::{.callout-note collapse=\"true\"}\n    ## Ayuda\n    Para realizar un contraste ANOVA podemos usar la función [`aov`](https://rdrr.io/r/stats/aov.html) del paquete `stats`.\n\n    Otra opción es utilizar la función para ajustar modelos de regresión lineales [`lm`](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/lm) y pasarle el modelo a la función [`anova`](https://rdrr.io/r/stats/anova.html) del paquete `stats`.\n\n    Si queremos mostrar la salida del test en formato de tabla podemos utilizar la función `tidy` del paquete [`broom`](https://broom.tidymodels.org/index.html).\n    :::\n\n    :::{.callout-tip collapse=\"true\"}\n    ## Solución\n    Tenemos que realizar el contraste\n\n    \\begin{align*}\n    H_0 &: \\mu_A = \\mu_B = \\mu_C \\\\\n    H_1 &: \\mbox{Existen diferencias entre al menos dos medias}\n    \\end{align*}\n\n    :::{.panel-tabset}\n    ## `aov`\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    library(knitr)\n    library(broom)\n    aov1 <- aov(nitrogeno ~ lugar, data = df) \n    aov1 |> \n        tidy() |> \n        kable()\n    ```\n    \n    ::: {.cell-output-display}\n    \n    \n    |term      | df|    sumsq|    meansq| statistic|  p.value|\n    |:---------|--:|--------:|---------:|---------:|--------:|\n    |lugar     |  2| 696.3036| 348.15179|  13.71644| 7.75e-05|\n    |Residuals | 27| 685.3164|  25.38209|        NA|       NA|\n    \n    \n    :::\n    :::\n\n\n    ## `lm`\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    lm(nitrogeno ~ lugar, data = df) |> \n        anova() |> \n        tidy() |> \n        kable()\n    ```\n    \n    ::: {.cell-output-display}\n    \n    \n    |term      | df|    sumsq|    meansq| statistic|  p.value|\n    |:---------|--:|--------:|---------:|---------:|--------:|\n    |lugar     |  2| 696.3036| 348.15179|  13.71644| 7.75e-05|\n    |Residuals | 27| 685.3164|  25.38209|        NA|       NA|\n    \n    \n    :::\n    :::\n\n    :::\n    \n    Como el p-valor del contraste es $0.00007$ que es mucho menor que el nivel de significación $\\alpha=0.05$, rechazamos la hipótesis nula y se concluye que existen diferencias estadísticamente significativas entre las concentraciones medias de NO2 de al menos dos lugares.\n    :::\n\na.  Realizar un contraste _post-hoc_ de comparación de las medias de N02 por pares. ¿Entre qué lugares existe una diferencia estadísticamente significativa en la concentración media de NO2?\n\n    :::{.callout-note collapse=\"true\"}\n    ## Ayuda\n    Para realizar un contraste post-hoc de comparación de medias por pares podemos usar la función [`TukeyHSD`](https://rdrr.io/r/stats/TukeyHSD.html) del paquete `stats`.\n\n    Otra opción es utilizar la función [`pairwise.t.test`](https://rdrr.io/r/stats/pairwise.t.test.html) del paquete `stats` que aplica la corrección de Bonferroni a los p-valores.\n    :::\n\n    :::{.callout-tip collapse=\"true\"}\n    ## Solución\n\n    :::{.panel-tabset}\n    ## Tukey HSD\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    TukeyHSD(aov(nitrogeno ~ lugar, data = df)) |> \n        tidy() |> \n        kable()\n    ```\n    \n    ::: {.cell-output-display}\n    \n    \n    |term  |contrast | null.value|  estimate|  conf.low|  conf.high| adj.p.value|\n    |:-----|:--------|----------:|---------:|---------:|----------:|-----------:|\n    |lugar |B-A      |          0| 12.432500|  6.507278| 18.3577222|   0.0000513|\n    |lugar |C-A      |          0|  8.045833|  2.344286| 13.7473810|   0.0045194|\n    |lugar |C-B      |          0| -4.386667| -9.735193|  0.9618592|   0.1234729|\n    \n    \n    :::\n    :::\n\n\n    ## Bonferroni\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    pairwise.t.test(df$nitrogeno, df$lugar, p.adjust.method = \"bonferroni\") |> \n        tidy() |> \n        kable()\n    ```\n    \n    ::: {.cell-output-display}\n    \n    \n    |group1 |group2 |   p.value|\n    |:------|:------|---------:|\n    |B      |A      | 0.0000531|\n    |C      |A      | 0.0049147|\n    |C      |B      | 0.1558055|\n    \n    \n    :::\n    :::\n\n    :::\n\n    Existe una diferencia muy significativa entre la concentración media de NO2 de los lugares $A$ y $B$ (p-valor $0.00005$), y también entre los lugares $A$ y $C$ (p-valor $0.0049$), pero no entre los lugares $B$ y $C$ (p-valor $0.1558$).\n    :::\n:::\n\n:::{#exr-anova-dos-factores-trigo}\nEl fichero [`trigo.csv`](https://aprendeconalf.es/estadistica-practicas-r/datos/trigo.csv) contiene información sobre la cosecha de trigo (en toneladas) obtenida para dos tipos de semillas y tres tipos de abonos ($A$, $B$ y $C$).\n\na.  Crear conjunto de datos con los datos de la muestra a partir del fichero [`trigo.csv`](https://aprendeconalf.es/estadistica-practicas-r/datos/trigo.csv).\n\n    :::{.callout-tip collapse=\"true\"}\n    ## Solución\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    library(tidyverse)\n    #df <- read_csv(\"https://aprendeconalf.es/estadistica-practicas-r/datos/trigo.csv\")\n    df <- read_csv(\"datos/trigo.csv\")\n    ```\n    :::\n\n    :::\n\na.  Realizar un contraste ANOVA para ver si la cosecha de trigo depende del abono.\n\n    :::{.callout-tip collapse=\"true\"}\n    ## Solución\n    Tenemos que realizar el contraste\n\n    \\begin{align*}\n    H_0 &: \\mu_A = \\mu_B = \\mu_C \\\\\n    H_1 &: \\mbox{Existen diferencias entre al menos dos medias}\n    \\end{align*}\n\n    :::{.panel-tabset}\n    ## `aov`\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    library(knitr)\n    library(broom)\n    aov(cosecha ~ abono, data = df) |> \n        tidy() |> \n        kable()\n    ```\n    \n    ::: {.cell-output-display}\n    \n    \n    |term      | df|    sumsq|    meansq| statistic|   p.value|\n    |:---------|--:|--------:|---------:|---------:|---------:|\n    |abono     |  2| 1.105369| 0.5526844|  5.795432| 0.0042462|\n    |Residuals | 93| 8.868994| 0.0953655|        NA|        NA|\n    \n    \n    :::\n    :::\n\n\n    ## `lm`\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    lm(semilla ~ abono, data = df) |> \n        anova() |> \n        tidy() |> \n        kable()\n    ```\n    \n    ::: {.cell-output-display}\n    \n    \n    |term      | df| sumsq|    meansq| statistic| p.value|\n    |:---------|--:|-----:|---------:|---------:|-------:|\n    |abono     |  2|     0| 0.0000000|         0|       1|\n    |Residuals | 93|    24| 0.2580645|        NA|      NA|\n    \n    \n    :::\n    :::\n\n    :::\n    \n    Como el p-valor del contraste es $0.0044$ que es mucho menor que el nivel de significación $\\alpha=0.05$, rechazamos la hipótesis nula y se concluye que existen diferencias estadísticamente significativas entre las medias de las cosechas de trigo de los distintos abonos, y por tanto, la cosecha depende del tipo de abono.\n    :::\n\na.  Realizar un contraste ANOVA para ver si la cosecha de trigo depende del abono y del tipo de semilla.\n\n    :::{.callout-note collapse=\"true\"}\n    ## Ayuda\n    Para realizar un contraste ANOVA de dos factores sin interacción se puede utilizar tanto la función `aov` como la función `lm` pero incluyendo la fórmula del modelo `vd ~ f1 + f2`, donde `vd` es la variable dependiente, `f1` es el primer factor y `f2` el segundo.\n    :::\n\n    :::{.callout-tip collapse=\"true\"}\n    ## Solución\n    Tenemos que realizar el contraste ANOVA de dos factores \n\n    :::{.panel-tabset}\n    ## `aov`\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    library(knitr)\n    library(broom)\n    aov(cosecha ~ semilla + abono, data = df) |> \n        tidy() |> \n        kable()\n    ```\n    \n    ::: {.cell-output-display}\n    \n    \n    |term      | df|    sumsq|    meansq| statistic|   p.value|\n    |:---------|--:|--------:|---------:|---------:|---------:|\n    |semilla   |  1| 2.781204| 2.7812042| 42.030162| 0.0000000|\n    |abono     |  2| 1.105369| 0.5526844|  8.352286| 0.0004643|\n    |Residuals | 92| 6.087790| 0.0661716|        NA|        NA|\n    \n    \n    :::\n    :::\n\n\n    ## `lm`\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    lm(cosecha ~ semilla + abono, data = df) |> \n        anova() |> \n        tidy() |> \n        kable()\n    ```\n    \n    ::: {.cell-output-display}\n    \n    \n    |term      | df|    sumsq|    meansq| statistic|   p.value|\n    |:---------|--:|--------:|---------:|---------:|---------:|\n    |semilla   |  1| 2.781204| 2.7812042| 42.030162| 0.0000000|\n    |abono     |  2| 1.105369| 0.5526844|  8.352286| 0.0004643|\n    |Residuals | 92| 6.087790| 0.0661716|        NA|        NA|\n    \n    \n    :::\n    :::\n\n    :::\n    \n    Como tanto el p-valor correspondiente a la semilla, que es prácticamente $0$, como el correspondiente al abono, que es $0.0004$, son menores que el nivel de significación $\\alpha=0.05$,  rechazamos la hipótesis nula y se concluye que la cosecha depende tanto del tipo de semilla como del tipo de abono.\n    :::\n\n\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}